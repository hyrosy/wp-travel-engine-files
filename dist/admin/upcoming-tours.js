(()=>{"use strict";var t={n:e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},d:(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=window.lodash;var o=t.n(e);document.addEventListener("DOMContentLoaded",(function(){const t=document.querySelector(".wpte-upcoming-tours-content-wrap"),e=document.querySelector(".wpte-dates-filter"),r=document.querySelectorAll(".wpte-filter-btn");t.addEventListener("click",(function(o){if(o.target.matches(".wpte-btn-view-details")&&(t.classList.add("loading"),a(o.target.dataset.id,o.target.dataset.nonce)(o.target)),o.target.closest(".wpte-upcoming-tours-details-close-btn")){const e=t.querySelector(".wpte-upcoming-tours-details");e&&(e.classList.remove("active"),e.remove())}const r=o.target.closest(".wpte-load-more-btn"),c=o.target.closest(".wpte-load-less-btn");if(r||c){var i,l;const r=e.querySelector(".wpte-filter-options").querySelector(".active"),a=parseInt(t.querySelector(".wpte-upcoming-tours-list").dataset.itemsCount),d=c?a-10:a+10,u=document.querySelector("#wpte-custom-filter-date").value,p=null!==(i=null!==(l=r?.dataset.date)&&void 0!==l?l:n(u))&&void 0!==i?i:"";p?s(p,e.dataset.nonce,d)(o.target):console.error("No trip data found")}}));const a=(e,o)=>async r=>{const a=new URLSearchParams({action:"wte_upcoming_tours_details",nonce:o,id:e}),n=`${wp.ajax.settings.url}?${a.toString()}`;try{const e=await fetch(n,{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"}}),o=await e.json();if(o.success){const e=o.data.html;t.innerHTML+=e,t.classList.remove("loading"),t.querySelector(".wpte-upcoming-tours-details").classList.add("active")}else console.error("Invalid HTML returned:",o)}catch(t){console.error("Error:",t)}};function n(t){if(o().isString(t)){const[e,o]=t.split(" to ");return JSON.stringify({from:e,to:o||e})}{var e;const o=t.map((t=>{const e=new Date(t);return e.setDate(e.getDate()+1),e.toISOString().split("T")[0]}));return JSON.stringify({from:o[0],to:null!==(e=o[1])&&void 0!==e?e:o[0]})}}r.forEach((t=>{t.addEventListener("click",(t=>{const{date:o}=t.target.dataset,r=e.dataset.nonce,a=e.querySelector("#wpte-custom-filter-date");a&&(a.value=""),t.target.parentElement.querySelector(".active")?.classList.remove("active"),t.target.classList.add("active"),o&&s(o,r)(t.target)}))})),flatpickr("#wpte-custom-filter-date",{mode:"range",showMonths:2,minDate:"today",onClose:function(t){if(o().isEmpty(t))return;const r=n(t);e.querySelector(".wpte-filter-options").querySelector(".active")?.classList.remove("active"),s(r,e.dataset.nonce)(document.querySelector("#wpte-custom-filter-date"))}});const s=(e,o,r)=>async a=>{a.classList.add("btn-loading"),a.disabled=!0,t.classList.add("loading");try{const n=await fetch(wp.ajax.settings.url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"wte_filter_upcoming_tours",nonce:o,date:e,count:r||t.querySelector(".wpte-upcoming-tours-list").dataset.itemsCount})}),s=await n.json();s.success&&s.data?.html?(t.innerHTML=s.data.html,t.classList.remove("loading"),a.classList.remove("btn-loading"),a.disabled=!1):console.error("Invalid HTML returned:",s)}catch(t){console.error("Error:",t)}}}))})();